<!DOCTYPE html>
<html>
<head>
<title>Skiresorts</title>
<link rel="stylesheet" type="text/css" href="css/fonts/font.css?v=1" />
<style>
body {
  font: normal 24px "Avenir-Black", sans-serif;
  line-height: 1;
}
.hide { display: none; }
#snow-icon,
#current-temp-icon,
#temp-icon {
  height: 46px;
  margin-right: 10px;
}
#location-icon {
  height: 76px;
  margin-right: 10px;
}
.big {
  font-size: 60px;
}
.medium {
  font-size: 40px;
}
.small {
  font-size: 26px;
}
.very-small {
  font-size: 20px;
}
.am-pm {
  text-transform: uppercase;
}
.bold {
  font-family: "Avenir-Black";
  font-weight: normal;
  font-style: normal;
}
.oblique {
  font-family: "Avenir-Oblique";
  font-weight: normal;
  font-style: normal;
}
.light {
  font-family: "Avenir-Light";
  font-weight: normal;
  font-style: normal;
}
#location .left,
#location .right {
  float: left;
}
.greeting {
  text-transform: uppercase;
}


.cotswold * {
  font-family: 'Univers LT Std'; font-weight: normal; font-style: normal;
}
.cotswold .big {
  font-family: 'GT Pressura'; font-weight: bold; font-style: normal;
  font-size: 90px;
}
.cotswold .content.big,
.cotswold .date {
  font-family: 'Univers LT Std'; font-weight: bold; font-style: normal;
  font-size: 30px;
}
.cotswold .greeting {
  text-transform: none;
}

.tp2bluewater *,
.tp2chertsey * {
  font-family: 'MinionPro'; font-weight: normal; font-style: normal;
}
.tp2bluewater .big,
.tp2chertsey .big {
  font-family: 'Tungsten'; font-weight: bold; font-style: normal;
  text-transform: uppercase;
  font-size: 70px;
  letter-spacing: 8px;
}
.tp2bluewater .content.big,
.tp2bluewater .date,
.tp2chertsey .content.big,
.tp2chertsey .date {
  font-family: 'A2Type'; font-weight: bold; font-style: normal;
  text-transform: none;
  letter-spacing: 0px;
}
.tp2bluewater #time .big,
.tp2chertsey #time .big {
  font-family: 'Tungsten'; font-weight: bold; font-style: normal;
  text-transform: uppercase;
  font-size: 70px;
  letter-spacing: 8px;
}

.tp2bluewater #time .am-pm,
.tp2chertsey #time .am-pm {
  font-family: 'Tungsten'; font-weight: bold; font-style: normal;
  text-transform: uppercase;
  font-size: 35px;
  letter-spacing: 8px;
}

</style>
</head>
<body class="color">

<div id="last-snowfall" class="hide">
  <span class="medium bold">LAST<br />SNOWFALL:<br /></span>
  <span class="medium light content"></span>
</div>

<div id="time" class="hide">
  <span class="small oblique">The Time is:<br /></span>
  <span class="content big bold color2"></span>
  <span class="small bold am-pm color2"></span>
</div>

<div id="snow-depth" class="hide">
  <svg version="1.1" id="snow-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
  	 viewBox="0 0 223.8 221" style="enable-background:new 0 0 223.8 221;" xml:space="preserve">
  <g>
  	<path class="st0" d="M44.2,158.7C28.9,156.3,0,143.5,0,112c0-27.4,21.8-40.6,37.5-45.2c0.2-11,2.5-33.1,17.1-49
  		C65.3,6,80.4,0,99.4,0c21.1,0,37.4,6.1,48.4,18.2c10.3,11.3,13.3,25.1,14.2,34c11.3-0.7,30.9,0.1,45.1,11.6
  		c10.7,8.6,16.3,21.3,16.7,37.7c0.1,0.9,2.2,32-22.3,44.8l-7.2-13.7c15.6-8.2,14.1-30.1,14.1-30.4c-0.3-12.3-3.9-20.8-11-26.5
  		c-15-12.1-41.2-7.4-41.5-7.4l-10.1,1.9l0.9-10.2c0-0.2,1.4-18.8-10.4-31.6c-8-8.6-20.4-13-36.9-13c-14.5,0-25.7,4.3-33.5,12.7
  		C50.8,44.7,53,71.9,53.1,72.2l0.6,7.2l-7.2,1.1c-1.2,0.2-31.1,5.3-31.1,31.5c0,26.4,29.8,31.3,31.1,31.5L44.2,158.7z"/>
  	<path class="st0" d="M176.6,139.7h-25.5l14.3-24.9c2.1-3.7,0.9-8.4-2.8-10.5c-3.7-2.1-8.4-0.9-10.5,2.8L137.8,132l-14.3-24.8
  		c-2.1-3.7-6.8-5-10.5-2.8c-3.7,2.1-5,6.8-2.8,10.5l14.3,24.9H96c-4.3,0-7.7,3.5-7.7,7.7s3.5,7.7,7.7,7.7h28.4L110.1,180
  		c-2.1,3.7-0.9,8.4,2.8,10.5c1.2,0.7,2.5,1,3.8,1c2.7,0,5.3-1.4,6.7-3.9l14.3-24.8l14.3,24.8c1.4,2.5,4,3.9,6.7,3.9
  		c1.3,0,2.6-0.3,3.8-1c3.7-2.1,5-6.8,2.8-10.5l-14.3-24.9h25.5c4.3,0,7.7-3.5,7.7-7.7S180.9,139.7,176.6,139.7z"/>
  	<path class="st0" d="M79.9,196.4L91.4,185c3-3,3-7.9,0-10.9c-3-3-7.9-3-10.9,0L69,185.5l-11.4-11.4c-3-3-7.9-3-10.9,0
  		c-3,3-3,7.9,0,10.9l11.4,11.4l-11.4,11.4c-3,3-3,7.9,0,10.9c1.5,1.5,3.5,2.3,5.5,2.3c2,0,4-0.8,5.5-2.3L69,207.3l11.4,11.4
  		c1.5,1.5,3.5,2.3,5.5,2.3c2,0,4-0.8,5.5-2.3c3-3,3-7.9,0-10.9L79.9,196.4z"/>
  </g>
  </svg>
  <span class="content big bold"></span><span class="small bold">CM</span>
</div>

<div id="current-temp" class="hide">
  <svg version="1.1" id="current-temp-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
  	 viewBox="0 0 99.6 229.1" style="enable-background:new 0 0 99.6 229.1;" xml:space="preserve">
  <g>
  	<path d="M75.2,136.4V27c0-14.9-12.1-27-27-27s-27,12.1-27,27v111.5C7.9,147.8,0,162.9,0,179.3c0,27.5,22.3,49.8,49.8,49.8
  		c27.5,0,49.8-22.3,49.8-49.8C99.6,161.6,90.3,145.4,75.2,136.4z M49.8,221.1c-23,0-41.8-18.7-41.8-41.8c0-14.3,7.2-27.5,19.3-35.2
  		c1-0.6,1.7-1.7,1.9-2.9c0,0,0-0.1,0-0.1c0-0.1,0-0.1,0-0.2c0-0.1,0-0.1,0-0.2c0,0,0,0,0,0V27C29.3,16.5,37.8,8,48.2,8
  		S67.1,16.5,67.1,27v111.8c0,0.3,0,0.5,0.1,0.8c0,0,0,0,0,0c0,0.1,0,0.1,0,0.2c0.1,0.3,0.2,0.6,0.3,0.8c0,0,0,0.1,0,0.1
  		c0,0.1,0.1,0.1,0.1,0.2c0,0.1,0.1,0.1,0.1,0.2c0,0,0,0.1,0.1,0.1c0.2,0.3,0.5,0.7,0.9,0.9c0,0,0.1,0.1,0.1,0.1c0,0,0.1,0.1,0.1,0.1
  		c0.1,0,0.1,0.1,0.2,0.1c0,0,0,0,0,0c13.8,7.3,22.3,21.4,22.3,37C91.6,202.3,72.8,221.1,49.8,221.1z"/>
  	<path d="M46.4,34.7H25.3c-1.7,0-3-1.4-3-3c0-1.7,1.4-3,3-3h21.1c1.7,0,3,1.4,3,3C49.4,33.3,48,34.7,46.4,34.7z"/>
  	<path d="M47,47.7H25.9c-1.7,0-3-1.4-3-3c0-1.7,1.4-3,3-3H47c1.7,0,3,1.4,3,3C50.1,46.4,48.7,47.7,47,47.7z"/>
  	<path d="M47,60.1H25.9c-1.7,0-3-1.4-3-3c0-1.7,1.4-3,3-3H47c1.7,0,3,1.4,3,3C50.1,58.8,48.7,60.1,47,60.1z"/>
  	<path d="M47,71.5H25.9c-1.7,0-3-1.4-3-3s1.4-3,3-3H47c1.7,0,3,1.4,3,3S48.7,71.5,47,71.5z"/>
  	<path d="M47,82.7H25.9c-1.7,0-3-1.4-3-3s1.4-3,3-3H47c1.7,0,3,1.4,3,3S48.7,82.7,47,82.7z"/>
  	<path d="M59.1,155.3v-47.8c0-5.5-4.5-10-10-10s-10,4.5-10,10v47.7c-10.9,4-18.8,14.5-18.8,26.8c0,15.8,12.8,28.6,28.6,28.6
  		c15.8,0,28.6-12.8,28.6-28.6C77.5,169.7,69.8,159.4,59.1,155.3z"/>
  </g>
  </svg>
  <span class="content big bold"></span>
</div>
<div id="temp" class="hide">
  <span class="date medium oblique color"></span><br /><br />
  <span class="greeting big color2">Good Morning</span><br />
  <span class="name big color2"></span><span class="big color2">...</span><br /><br /><br />
  <svg version="1.1" id="temp-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
  	 viewBox="0 0 99.6 229.1" style="enable-background:new 0 0 99.6 229.1;" xml:space="preserve">
  <g>
  	<path d="M75.2,136.4V27c0-14.9-12.1-27-27-27s-27,12.1-27,27v111.5C7.9,147.8,0,162.9,0,179.3c0,27.5,22.3,49.8,49.8,49.8
  		c27.5,0,49.8-22.3,49.8-49.8C99.6,161.6,90.3,145.4,75.2,136.4z M49.8,221.1c-23,0-41.8-18.7-41.8-41.8c0-14.3,7.2-27.5,19.3-35.2
  		c1-0.6,1.7-1.7,1.9-2.9c0,0,0-0.1,0-0.1c0-0.1,0-0.1,0-0.2c0-0.1,0-0.1,0-0.2c0,0,0,0,0,0V27C29.3,16.5,37.8,8,48.2,8
  		S67.1,16.5,67.1,27v111.8c0,0.3,0,0.5,0.1,0.8c0,0,0,0,0,0c0,0.1,0,0.1,0,0.2c0.1,0.3,0.2,0.6,0.3,0.8c0,0,0,0.1,0,0.1
  		c0,0.1,0.1,0.1,0.1,0.2c0,0.1,0.1,0.1,0.1,0.2c0,0,0,0.1,0.1,0.1c0.2,0.3,0.5,0.7,0.9,0.9c0,0,0.1,0.1,0.1,0.1c0,0,0.1,0.1,0.1,0.1
  		c0.1,0,0.1,0.1,0.2,0.1c0,0,0,0,0,0c13.8,7.3,22.3,21.4,22.3,37C91.6,202.3,72.8,221.1,49.8,221.1z"/>
  	<path d="M46.4,34.7H25.3c-1.7,0-3-1.4-3-3c0-1.7,1.4-3,3-3h21.1c1.7,0,3,1.4,3,3C49.4,33.3,48,34.7,46.4,34.7z"/>
  	<path d="M47,47.7H25.9c-1.7,0-3-1.4-3-3c0-1.7,1.4-3,3-3H47c1.7,0,3,1.4,3,3C50.1,46.4,48.7,47.7,47,47.7z"/>
  	<path d="M47,60.1H25.9c-1.7,0-3-1.4-3-3c0-1.7,1.4-3,3-3H47c1.7,0,3,1.4,3,3C50.1,58.8,48.7,60.1,47,60.1z"/>
  	<path d="M47,71.5H25.9c-1.7,0-3-1.4-3-3s1.4-3,3-3H47c1.7,0,3,1.4,3,3S48.7,71.5,47,71.5z"/>
  	<path d="M47,82.7H25.9c-1.7,0-3-1.4-3-3s1.4-3,3-3H47c1.7,0,3,1.4,3,3S48.7,82.7,47,82.7z"/>
  	<path d="M59.1,155.3v-47.8c0-5.5-4.5-10-10-10s-10,4.5-10,10v47.7c-10.9,4-18.8,14.5-18.8,26.8c0,15.8,12.8,28.6,28.6,28.6
  		c15.8,0,28.6-12.8,28.6-28.6C77.5,169.7,69.8,159.4,59.1,155.3z"/>
  </g>
  </svg>
  <span class="content color big light"></span>
</div>
<div id="location" class="hide">
  <div class="left">
    <svg version="1.1" id="location-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
    	 viewBox="0 0 200 300" style="enable-background:new 0 0 200 300;" xml:space="preserve">
      <path class="st0" d="M189.7,53c-26-48-66-53-87-53S38.2,2.3,13.3,51c-26,51-7.6,76.5,3.4,100c12.2,26.1,86,149,86,149l82-145
      	C184.7,155,215.7,101,189.7,53z M101.3,170c-37.6,0-68-30.4-68-68s30.4-68,68-68s68,30.4,68,68S138.8,170,101.3,170z"/>
      <circle class="st0" cx="101.3" cy="102" r="50.7"/>
    </svg>
  </div>
  <div class="right">
    <span class="name big bold"></span><br />
    <span class="country small bold"></span><br /><br />
    <span class="coordinates mall light"></span>
  </div>
</div>
<div id="weather" class="hide">
    <span class="small bold">Wind</span><br />
    <span class="small light wind"></span><br /><br />
    <span class="small bold">Humidity</span><br />
    <span class="small light humidity"></span><br /><br />
    <span class="small bold">Pressure</span><br />
    <span class="small light pressure"></span><br /><br />
    <span class="small bold">Visibility</span><br />
    <span class="small light visibility"></span>
</div>
<div id="elevation" class="hide">
  <span class="name medium bold">Highest<br />Elevation:</span><br />
  <span class="elevation medium"></span>
</div>

<script type="application/javascript">

var resorts = [{
  resort: 'tp2chertsey',
  name: 'CHERTSEY',
  country: 'UK',
  coordinates: '46°01’’N 7°45’’E',
  account: 'NPego8Cja0',
  forcast: '82f489f4-9fa9-4dcb-8185-57afe1906f3f',
  snowreport: '1e349962-68c3-4383-a3f3-57616db0b7f1',
  GMT: +1
},{
  resort: 'tp2alphedhuez',
  name: 'ALPE D\' HUEZ',
  country: 'FRANCE',
  coordinates: '45°03’37’’N 6°04’17’’E',
  account: 'UkRYIY5Whp',
  forcast: '2991d3de-12c0-438d-921a-b3dbecd3c949',
  snowreport: '792ffcd1-028b-4adc-a764-c7c2c20b0fde',
  GMT: +2
}, {
  resort: 'tp2breckenridge',
  name: 'BRECKENRIDGE',
  country: 'USA',
  coordinates: '39°29’59’’N 106°02’36’’W',
  account: 'THJcklriyN',
  forcast: '7b136fa9-d868-492e-a284-aecb17fd6eef',
  snowreport: '8d65de05-cfca-4307-9dec-5f548e03de7a',
  GMT: -6
}, {
  resort: 'tp2courmayeur',
  name: 'COURMAYEUR',
  country: 'ITALY',
  coordinates: '45°47’’N 06°58’’E',
  account: 'Df7wkAweLQ',
  forcast: '8efb0146-e8eb-464f-a328-3b7f4a79dedb',
  snowreport: '25b98756-d0e9-4203-8e6c-df6089c2ee0e',
  GMT: +2
}, {
  resort: 'tp2hintertux',
  name: 'HINTERTUX',
  country: 'AUSTRIA',
  coordinates: '47°3’55’’N 11°40’45’’E',
  account: '8jc5Eu3e4C',
  forcast: '11d09aee-3ac1-4161-ac0c-13595e757f30',
  snowreport: '1b627726-d3b0-473e-a029-28018eb5028d',
  GMT: +2,
  elevation: '3,250 m'
}, {
  resort: 'tp2morzine',
  name: 'MORZINE',
  country: 'FRANCE',
  coordinates: '46°11’27’’N 6°46’30’’E',
  account: 'RgH5Ks6jCr',
  forcast: '08cb197d-4a71-49e2-895b-ac876c3d245b',
  snowreport: '04708dfc-2198-4f26-90a8-28f61079864d',
  GMT: +2
}, {
  resort: 'tp2obergurgl',
  name: 'OBERGURGL',
  country: 'AUSTRIA',
  coordinates: '46°52’’N 11°01’’E',
  account: 'X8I3hz-NC2',
  forcast: '9535dd41-27f4-4f96-8d60-538336cef56a',
  snowreport: 'c327ac4d-ba15-40eb-8416-5d7bb1496090',
  GMT: +2
}, {
  resort: 'tp2whistler',
  name: 'WHISTLER',
  country: 'CANADA',
  coordinates: '50°7’15’’N 122°57’16’’W',
  account: 'COoQ/73XZB',
  forcast: '1d1eaef5-5e87-4f22-a724-0930c4a910a8',
  snowreport: 'a32ad6bb-fedf-4bc4-9d6d-21c9d8e982b4',
  GMT: -7
}, {
  resort: 'tp2zermatt',
  name: 'ZERMATT',
  country: 'SWITZERLAND',
  coordinates: '46°01’’N 7°45’’E',
  account: 'tOLINlR3sY',
  forcast: '36fc3f68-4240-4847-9915-0119a891cf40',
  snowreport: '1e349962-68c3-4383-a3f3-57616db0b7f1',
  GMT: +2
}, {
  resort: 'tp2machupiccu',
  name: 'MACHU PICCU',
  country: 'PERU',
  elevation: '2,430 m',
  coordinates: '13°09’48’’S 72°32’44’’W',
  account: 'kea/lcJmpx',
  forcast: 'f5fa39d8-0a39-4ef6-b28e-57d23022c290',
  GMT: -5
}, {
  resort: 'tp2chamonixvalley',
  name: 'CHAMONIX VALLEY',
  country: 'AUVERGNE-RHÔNE-ALPES',
  elevation: '3,842 m',
  coordinates: '45°55’23’’N / 6°52’11’’E',
  account: 'N-TTrFZ356',
  forcast: 'c5691917-47c2-48ba-8513-9b5efdc5ddea',
  GMT: +2
}, {
  resort: 'tp2everest',
  name: 'EVEREST BASE CAMP',
  country: 'KHUMJUNG 56000, NEPAL',
  elevation: '5,364 m',
  coordinates: '28°0’26”N / 86°51’34”E',
  account: 'p8rSFb67a.',
  forcast: '6577fdad-24ee-48e1-bcc0-7e45067a55cc',
  GMT: +8
}, {
  resort: 'tp2killimanjaro',
  name: 'KILIMANJARO',
  country: 'TANZANIA',
  elevation: '5,895 m',
  coordinates: '03°04’33’’S / 37°21’12’’E',
  account: 'eOO6Bm6AlZ',
  forcast: '7c9df3f3-66cc-4c26-8f94-7b94abaaffd2',
  GMT: +3
}, {
  resort: 'tp2tignes',
  name: 'TIGNES',
  country: 'TARENTAISE VALLEY, FRANCE',
  elevation: '3,747 m',
  coordinates: '45°28’06’’N / 6°54’20’’E',
  account: 'UO5cVq2j6M',
  forcast: '0d6c0f0b-4f21-4d55-b558-f1b01aab314a',
  GMT: +2
}, {
  resort: 'tp2cervinia',
  name: 'CERVINIA',
  country: 'VALLE D’AOSTA, ITALY',
  elevation: '3,480 m',
  coordinates: '45°56’04’’N / 7°37’52’’E',
  account: 'Lbg2TKgReP',
  forcast: '0d67439b-ec53-4619-bad1-db57596949b4',
  GMT: +2
}, {
  resort: 'tp2yellowstone',
  name: 'YELLOW STONE NATIONAL PARK',
  country: 'USA',
  elevation: '2,400 m',
  coordinates: '44°33’10’’N / 110°17’30’’W',
  account: 'Yngnlu1qVS',
  forcast: '2388b1e9-7c5a-414c-a7cf-a346efa5754e',
  GMT: -6
}, {
  resort: 'tp2cotswold',
  name: 'Biggleswade',
  country: 'Cotswold',
  elevation: '151 m',
  coordinates: '52.073627,-0.2438715',
  account: 'YdeAjt80eO',
  forcast: 'd48168f2-364f-4d71-9954-02067927b8db',
  GMT: +1
}, {
  resort: 'tp2bagshot',
  name: 'Bagshot',
  country: 'Cotswold',
  elevation: '57 m',
  coordinates: '51.3649302,-0.7248693',
  account: 'NOMb7ID6GN',
  forcast: '4793379d-fa3c-45f6-af37-81b7560a4d9d',
  GMT: +1
}, {
  resort: 'tp2bluewater',
  name: 'Bluewater',
  country: 'Bluewater',
  elevation: '57 m',
  coordinates: '51.4387377,0.2688127',
  account: 'EJJKzNmMi-',
  forcast: '1ea113fa-1e02-4e4a-81fe-a909c5845135',
  GMT: +1
}];

var account = resorts[0].account;
var forcast = resorts[0].forcast;
var snowreport = resorts[0].snowreport;
var name = resorts[0].name;
var country = resorts[0].country;
var coordinates = resorts[0].coordinates;
var GMT = 2;
var show = 'last-snowfall';
var elevation = resorts[0].elevation;
var defaultColor = 'b6092a';
var query = window.location.search.replace('?','').split('&');
var fetchEveryXMinutes = 15;

setColor = function(color) {
  var colorItems = document.querySelectorAll('.color');
  for(var i=0; i<colorItems.length; i++) {
    colorItems[i].style.color = '#'+(color || defaultColor);
  }
  document.querySelector('#snow-icon').style.fill = '#'+(color || defaultColor);
  document.querySelector('#current-temp-icon').style.fill = '#'+(color || defaultColor);
  document.querySelector('#temp-icon').style.fill = '#'+(color || defaultColor);
  document.querySelector('#location-icon').style.fill = '#'+(color || defaultColor);
}
setColor();

setColor2 = function(color) {
  var colorItems = document.querySelectorAll('.color2');
  for(var i=0; i<colorItems.length; i++) {
    colorItems[i].style.color = '#'+(color || '111111');
  }
}
setColor2();

for(var i=0; i<query.length; i++) {
  var params = query[i].split('=');
  switch(params[0]) {
    case 'show':
      var el = document.getElementById(params[1]);
      if(el) {
        el.className = el.className.replace('hide','');
      }
      break;
    case 'color':
      setColor(params[1]);
      break;
    case 'color2':
      setColor2(params[1]);
      break;
    case 'resort': var resort = params[1];
      for(var i=0; i<resorts.length; i++) {
        if(resorts[i].resort === resort) {
          account = resorts[i].account;
          forcast = resorts[i].forcast;
          snowreport = resorts[i].snowreport;
          name = resorts[i].name;
          country = resorts[i].country;
          coordinates = resorts[i].coordinates;
          GMT = resorts[i].GMT;
          elevation = resorts[i].elevation;
        }
      }
      break;
  }
}

// if (resort === 'tp2cotswold') {
if (['tp2cotswold','tp2bagshot', 'tp2bluewater', 'tp2chertsey'].indexOf(resort)!==-1) {
  document.body.classList.add('cotswold');
  document.body.classList.add(resort);
}

(function() {
    var cors_api_host = 'cors-anywhere.herokuapp.com'; // https://crossorigin.me/
    var cors_api_url = 'https://' + cors_api_host + '/';
    var slice = [].slice;
    var origin = window.location.protocol + '//' + window.location.host;
    var open = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function() {
        var args = slice.call(arguments);
        var targetOrigin = /^https?:\/\/([^\/]+)/i.exec(args[1]);
        if (targetOrigin && targetOrigin[0].toLowerCase() !== origin &&
            targetOrigin[1] !== cors_api_host) {
            args[1] = cors_api_url + args[1];
        }
        return open.apply(this, args);
    };
})();

// FORCAST
function getForeCast() {
  if(!localStorage[resort+'lastFetch'] || (localStorage[resort+'lastFetch'] < Date.now())) {
    localStorage[resort+'lastFetch'] = Date.now() + fetchEveryXMinutes * 60 * 1000;
    console.log('FETCHING NEW DATA');
    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'http://www.myweather2.com/developer/weather.ashx?uac='+account+'&uref='+forcast+'&output=json&'+(new Date()).getTime());
    xhr.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        var result = JSON.parse(this.response);
        console.log('getForeCast', result);
        if(result.weather && result.weather.current_weather) {
          var string = 'High: '+result.weather.forecast[0].day_max_temp+'&deg;'+result.weather.forecast[0].temp_unit;
          string += ' / Low: '+result.weather.forecast[0].night_min_temp+'&deg;'+result.weather.forecast[0].temp_unit;
          document.querySelector('#current-temp .content').innerHTML = localStorage[resort+'currentTemp'] = result.weather.current_weather[0].temp+'&deg;';
          document.querySelector('#temp .content').innerHTML = localStorage[resort+'temp'] = string;
          
          if (result.weather.forecast[0].day && result.weather.forecast[0].day[0] && result.weather.forecast[0].day[0].wind) {
            document.querySelector('#weather .wind').innerHTML = localStorage[resort+'wind'] = result.weather.forecast[0].day[0].wind[0].speed + ' km / h';
            document.querySelector('#weather .humidity').innerHTML = localStorage[resort+'humidity'] = result.weather.forecast[0].day[0].humidity + '%';
            document.querySelector('#weather .pressure').innerHTML = localStorage[resort+'pressure'] = result.weather.forecast[0].day[0].pressure_mb + ' mb';
            document.querySelector('#weather .visibility').innerHTML = localStorage[resort+'visibility'] = result.weather.forecast[0].day[0].visibility_km + ' km';
          }
        }
      }
    };
    xhr.setRequestHeader('Access-Control-Request-Method','GET');
    xhr.send();
  } else {
    console.log('USING DATA FROM MAX '+fetchEveryXMinutes+' MINUTES AGO');
    document.querySelector('#current-temp .content').innerHTML = localStorage[resort+'currentTemp'];
    document.querySelector('#temp .content').innerHTML = localStorage[resort+'temp'];
    document.querySelector('#weather .wind').innerHTML = localStorage[resort+'wind'];
    document.querySelector('#weather .humidity').innerHTML = localStorage[resort+'humidity'];
    document.querySelector('#weather .pressure').innerHTML = localStorage[resort+'pressure'];
    document.querySelector('#weather .visibility').innerHTML = localStorage[resort+'visibility'];
  }
}

// snowreport
function getSnowReport() {
  if(!localStorage[resort+'lastSnowReportFetch'] || (localStorage[resort+'lastSnowReportFetch'] < Date.now())) {
    localStorage[resort+'lastSnowReportFetch'] = Date.now() + fetchEveryXMinutes * 60 * 1000;
    console.log('FETCHING NEW DATA');
    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'http://www.myweather2.com/developer/weather.ashx?uac='+account+'&uref='+snowreport+'&output=json&'+(new Date()).getTime());
    xhr.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        var result = JSON.parse(this.response);
        console.log('getSnowReport', result);
        if(result.weather && result.weather.snow_report) {
          var dateString = result.weather.snow_report[0].last_snow_date + ' ' + (new Date().getUTCFullYear());
          var date = new Date(dateString);
          document.querySelector('#last-snowfall .content').innerHTML = localStorage[resort+'lastSnowfall'] = date.toLocaleDateString();
          document.querySelector('#snow-depth .content').innerHTML = localStorage[resort+'snowDepth'] = result.weather.snow_report[0].upper_snow_depth;
        }
      }
    };
    xhr.setRequestHeader('Access-Control-Request-Method','GET');
    xhr.send();
  } else {
    console.log('USING DATA FROM MAX '+fetchEveryXMinutes+' MINUTES AGO');
    document.querySelector('#last-snowfall .content').innerHTML = localStorage[resort+'lastSnowfall'];
    document.querySelector('#snow-depth .content').innerHTML = localStorage[resort+'snowDepth'];
  }
}

Date.prototype.getTimezone = function() {
    var jan = new Date(this.getFullYear(), 0, 1);
    var jul = new Date(this.getFullYear(), 6, 1);

    var utcOffset = new Date().getTimezoneOffset() / 60 * -1;
    var dstOffset = (jan.getTimezoneOffset() - jul.getTimezoneOffset()) / 60;
    
    return (utcOffset + dstOffset);
}

var greeting = document.querySelector('.greeting').innerHTML;
function setTime() {
  /*var time = new Date();
  var date = new Date(time.getTime() + (GMT*60*60*1000));*/
  // console.log((new Date()).getTimezone(), new Date().getTimezoneOffset() / 60 * -1);
  var date = new Date(Date.now() + ((new Date().getTimezoneOffset() / 60)+GMT)*60*60*1000);
  var hour = date.getHours();
  var minutes = date.getMinutes();
  document.querySelector('#time .content').innerHTML = (hour < 10? '0' : '' ) + hour + ':' + (minutes < 10 ? '0' : '') + minutes;
  document.querySelector('#time .am-pm').innerHTML = (hour > 11 ? 'pm' : 'am');
  if ((hour > 11) && (greeting !== 'Good Afternoon')) {
    greeting = 'Good Afternoon';
    document.querySelector('.greeting').innerHTML = greeting;
  }
  if ((hour > 18) && (greeting !== 'Good Evening')) {
    greeting = 'Good Evening';
    document.querySelector('.greeting').innerHTML = greeting;
  }
}
setTime();
setInterval(setTime,1000);

var date = new Date();
var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
var months = ['Januari', 'Februari', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

document.querySelector('#temp .date').innerHTML = days[date.getDay()]+(date.getDate()<10?' 0':' ')+date.getDate()+' '+months[date.getMonth()]+' '+date.getFullYear();
document.querySelector('#temp .name').innerHTML = name;
document.querySelector('#location .name').innerHTML = name;
document.querySelector('#location .country').innerHTML = country;
document.querySelector('#location .coordinates').innerHTML = coordinates;
if (elevation) {
  document.querySelector('#elevation .elevation').innerHTML = elevation;
}

for(var i=0; i<query.length; i++) {
  var params = query[i].split('=');
  if (params[0] == 'show') {
    switch(params[1]) {
      case 'last-snowfall':
      case 'snow-depth':
        getSnowReport();
        break;
      case 'temp':
      case 'weather':
      case 'current-temp':
        getForeCast();
        break;
      case 'time':
      case 'location':
      case 'elevation':
        console.log('no need to fetch data',params[1]);
        break;
      default: alert('Please provide one of the following values to the end of the url: &show=last-snowfall, &show=snow-depth, &show=temp, &show=current-temp, &show=time, &show=location');
    }
  }
}

</script>

</body>
</html>
